#include <stdio.h>
#include <math.h>

float x[100];
float XR[100];
float XI[100];
float b[51];
float y[100];
int N = 100;
float amplitude[100];
float amplitude1[100];
float phase[100];

float h[51] = {
     0.002188705630357, -0.000638196417592, -0.002323290185628, -0.003687309972587,
    -0.003202638102151, -0.000228989440978,  0.004114802194473,  0.007138644047908,
     0.006070226770999,  0.000143232593943, -0.008100148523334, -0.013521056182109,
    -0.011237269221803, -0.000195681227433,  0.014812648851330,  0.024611116454230,
     0.020482912979806,  0.000221994160970, -0.028240148498254, -0.048445499309018,
    -0.042441047491530, -0.000240858260315,  0.073182638047458,  0.157570608526135,
     0.224692607548277,  0.250247872132066,  0.224692607548277,  0.157570608526135,
     0.073182638047458, -0.000240858260315, -0.042441047491530, -0.048445499309018,
    -0.028240148498254,  0.000221994160970,  0.020482912979806,  0.024611116454230,
     0.014812648851330, -0.000195681227433, -0.011237269221803, -0.013521056182109,
    -0.008100148523334,  0.000143232593943,  0.006070226770999,  0.007138644047908,
     0.004114802194473, -0.000228989440978, -0.003202638102151, -0.003687309972587,
    -0.002323290185628, -0.000638196417592,  0.002188705630357
};

int main(void) {
    int i, j, n;

    // Input signal
    for (i = 0; i < 100; i++) {
        x[i] = 0;
        x[i] = 5 + (2 * sin(2 * 3.14 * 30 * i / 100)) + (3 * cos(2 * 3.14 * 2 * i / 100));
    }

    // DFT before filtering
    for (j = 0; j < N; j++) {
        XR[j] = 0;
        XI[j] = 0;
        for (i = 0; i < N; i++) {
            XR[j] = XR[j] + (x[i] * cos(2 * 3.14 * i * j / N));
            XI[j] = XI[j] - (x[i] * sin(2 * 3.14 * i * j / N));
        }
    }

    for (i = 0; i < N; i++) {
        amplitude[i] = sqrt((XR[i] * XR[i]) + (XI[i] * XI[i]));
    }

    // FIR Filter
    for (n = 0; n < 100; n++) {
        y[n] = 0;
        b[0] = x[n];

        for (i = 51; i > 0; i--) {
            b[i] = b[i - 1];
        }

        for (i = 0; i < 51; i++) {
            y[n] = y[n] + (h[i] * b[i]);
        }
    }

    // DFT after filtering
    for (j = 0; j < N; j++) {
        XR[j] = 0;
        XI[j] = 0;
        for (i = 0; i < N; i++) {
            XR[j] = XR[j] + (y[i] * cos(2 * 3.14 * i * j / N));
            XI[j] = XI[j] - (y[i] * sin(2 * 3.14 * i * j / N));
        }
    }

    for (i = 0; i < N; i++) {
        amplitude1[i] = sqrt((XR[i] * XR[i]) + (XI[i] * XI[i]));
    }

    return 0;
}
